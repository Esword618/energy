<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ipc-event</title>
    <style>
        button {
            margin: 5px;
        }
    </style>
    <script type="application/javascript">
        let idx = 0;
        let si = null;

        function autoIpcEmit() {
            if (si != null) {
                clearInterval(si)
                si = null
                idx = 0
                msg("停止 auto ipc emit idx",idx)
                return
            }
            msg("启动 auto ipc emit")
            si = setInterval(ipcEmit, 1)
            if (si != null) {
                let time = document.getElementById("time").value - 0
                if (time > 0) {
                    setTimeout(function () {
                        clearInterval(si)
                        si = null
                    }, time)
                }
            }
        }

        function ipcEmit() {
            idx++;
            let objectValueArray = [
                100, 200, "数组里的字符串", 66996.99,
            ]
            let objectValue = {
                "stringField": "string 字符串字符串字符串字符串字符串字符串字符串字符串字string 符串字符串字符串字符串字符串字符串字符串字符串字符串字符串字符string 串字符串字符串字符串字符串字符string 串字符串字符串字符串string 字符串字符串字符串字符串字符串字符串字符串字符串字符串字符串字符串",
                "intField": 1000,
                "arrayField": objectValueArray,
                "doubleField": 999991.102,
                "booleanField": true,
            }
            let arrayValue = [
                100, 200, "数组里的字符串", 66996.99, objectValue, true, false
            ]
            let args1 = "中文中文中文中文中文中文中文string 中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文string 中文中文中文中文中文中文中文中文中文中文中文中文中string 文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文中文"
            let ok = ipc.emit("testEmitName", [args1, idx, true, 1999.66 + idx, "字符串？", 29999.66 + idx, objectValue, arrayValue, 8888888888888 + idx, null, undefined],
                function (r1, r2, r3, r4, r5, r6, r7, r8, r9) {
                    clearMsg()
                    msg("r1", r1);
                    msg("r2", r2);
                    msg("r3", r3);
                    msg("r4", r4);
                    msg("r5", r5);
                    msg("r6", r6, JSON.stringify(r6));
                    msg("r7", r7, JSON.stringify(r7));
                    msg("r8", r8, JSON.stringify(r8));
                    msg("r9", r9, JSON.stringify(r9));
                });
            //msg('ipc.emit ok?', ok);

            //let ok1 = ipc.emit([]);
            // msg('ipc.emit ok?', ok1);
        }

        function testInArgs() {
            clearMsg()
            let map = {
                "key1": "value1value1value1value1",
                "key2": "value2value2value2vaaaaaaalue2",
                "key3": "value3value3value3",
                "key4": 1231,
                "key5": 1231.33,
                "key6": true,
                "subObj": {
                    "StringField": "StringFieldStringFieldStringField",
                    "IntField": 3333333,
                    "BoolField": true,
                    "FloatField": 1006588.666
                }
            }
            let args8 = {
                "key1": "value1value1value1value1",
                "key2": "value2value2value2vaaaaaaalue2",
                "key3": "value3value3value3"
            }
            let arr = ["adsfsadf", "fffffff"]
            let args10 = [1111111.1111, 222222.222]
            ipc.emit("testInArgs", ["字符串参数", 123123, true, arr, map, map, {"structMap": map}, args8, 9999999.99999, args10]);
        }

        function testResultArgs() {
            clearMsg()
            ipc.emit("testResultArgs", [6666], function (r1) {
                msg('r1', r1)
            })
        }

        ipc.on('onTestName1', function (param1, param2, param3) {

        });
        ipc.on('onTestName2', function (param1, param2, param3) {

        });

        function bindFunc() {
            energy.funcName();
        }

        function bindField() {
            clearMsg();
            msg('stringField', energy.stringField);
            msg('intField', energy.intField);
            msg('doubleField', energy.doubleField);
            msg('boolField', energy.boolField);
        }
    </script>
</head>
<body style="margin: 0px;padding: 0px;">
<p>
<h3>process-message</h3></p>
<p><a target="_blank" href="ipc-event.html">open</a></p>
<p>
    <button onclick="ipcEmit()">ipcEmit</button>
    <button onclick="autoIpcEmit()">自动-ipcEmit</button>
    <input id="time" value="0">
    <br>
    <button onclick="testInArgs()">testInArgs</button>
    <button onclick="testResultArgs()">testResultArgs</button>
    <br>
    <button onclick="bindFunc()">bindFunc</button>
    <button onclick="bindField()">bindField</button>
</p>
<p id="msgHtml"></p>
</body>
<script type="application/javascript">
    let msgHtml = document.getElementById("msgHtml");

    function msg(...vvv) {
        let str = msgHtml.innerHTML;
        for (let i = 0; i < vvv.length; i++) {
            str = str + "  " + vvv[i];
        }
        str += "<br>";
        msgHtml.innerHTML = str;
    }

    function clearMsg() {
        msgHtml.innerHTML = "";
    }

    msg("ipc-event: 页面加载完成...");
</script>
</html>